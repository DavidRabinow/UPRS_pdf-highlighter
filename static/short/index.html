const express = require('express');
const bodyParser = require('body-parser');
const shortid = require('shortid');
const moment = require('moment');

const app = express();
const port = 3000;

// In-memory storage for demonstration purposes
const urlDatabase = {};

// Middleware
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

// URL shortener endpoint
app.post('/api/short', (req, res) => {
    const longUrl = req.body.url;
    const domain = req.body.domain;
    const customId = req.body.custom ? req.body.custom : shortid.generate();
    const expiration = req.body.expiration; // Handle expiration here

    // Validate the URL here, if necessary

    // Save the URL (implement expiration logic accordingly)
    urlDatabase[customId] = { longUrl, domain, expiration };

    // Send response
    res.json({
        success: true,
        domain,
        id: customId,
        editkey: shortid.generate(), // Generate an edit key if necessary
        expiration: expiration // Return the expiration timestamp
    });
});

// Serve static files for testing (HTML)
app.use(express.static('public'));

app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});
