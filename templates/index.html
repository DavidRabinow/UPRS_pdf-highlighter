<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Selenium Automation Control Panel</title>
    <style>
      body {
        background: #1a2236;
        color: #fff;
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      .container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 16px rgba(26, 34, 54, 0.1);
        max-width: 700px;
        margin: 40px auto;
        padding: 32px 36px 36px 36px;
        color: #1a2236;
      }
      .automation-header {
        display: flex;
        align-items: center;
        background: #1a2236;
        color: #fff;
        padding: 24px 32px;
        border-radius: 10px;
        margin-bottom: 32px;
        box-shadow: 0 2px 8px rgba(26, 34, 54, 0.08);
      }
      .automation-header img {
        height: 70px;
        margin-right: 32px;
        background: #e5e7eb;
        border-radius: 8px;
        padding: 8px;
      }
      .automation-header span {
        font-size: 2.2rem;
        font-weight: bold;
        letter-spacing: 2px;
        color: #fff;
      }
      .input-container,
      .status-container {
        background: #f5f6fa;
        border-radius: 8px;
        padding: 24px 20px 20px 20px;
        margin-bottom: 28px;
        box-shadow: 0 1px 4px rgba(26, 34, 54, 0.04);
        color: #1a2236;
      }
      .input-label {
        color: #1a2236;
        font-weight: 500;
        margin-top: 12px;
        display: block;
      }
      .text-input,
      select {
        width: 100%;
        padding: 10px;
        margin: 8px 0 18px 0;
        border: 1px solid #1a2236;
        border-radius: 4px;
        background: #fff;
        color: #1a2236;
        font-size: 1rem;
        box-sizing: border-box;
      }
      .button-container {
        text-align: center;
        margin-bottom: 24px;
      }
      .start-button,
      .reset-button {
        background: #1a2236;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 12px 32px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        margin: 0 8px;
      }
      .start-button:hover,
      .reset-button:hover {
        background: #232b43;
      }
      .status-container h3 {
        color: #1a2236;
        margin-top: 0;
      }
      .status-item {
        margin-bottom: 10px;
        color: #1a2236;
      }
      .status-idle strong {
        color: #1a2236;
      }
      .uprs-logo-corner {
        position: absolute;
        top: 24px;
        left: 32px;
        z-index: 100;
      }
      @media (max-width: 600px) {
        .uprs-logo-corner {
          top: 8px;
          left: 8px;
        }
        .uprs-logo-corner img {
          height: 70px;
        }
      }
      @media (max-width: 800px) {
        .container {
          padding: 12px 4vw;
        }
        .automation-header {
          flex-direction: column;
          text-align: center;
          padding: 18px 8px;
        }
        .automation-header img {
          margin: 0 0 12px 0;
        }
      }
      .stux-footer {
        text-align: center;
        color: #e5e7eb;
        background: transparent;
        font-size: 1rem;
        margin: 40px 0 16px 0;
      }
      .stux-footer a {
        color: #e5e7eb;
        text-decoration: underline;
        font-weight: 600;
      }
      .stux-footer a:hover {
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="uprs-logo-corner">
      <img
        src="/static/assets/uprs.png"
        alt="UPRS Logo"
        style="height: 60px; width: auto; display: block"
      />
    </div>
    <div class="container">
      <div class="automation-header">
        <span
          style="
            font-size: 2.2rem;
            font-weight: bold;
            letter-spacing: 2px;
            color: #fff;
          "
          >Selenium Automation Control Panel</span
        >
      </div>

      <div class="input-container">
        <label for="searchText" class="input-label">Enter search text:</label>
        <input
          type="text"
          id="searchText"
          class="text-input"
          placeholder="Enter the text you want to search for..."
          value=""
        />

        <label for="companyName" class="input-label"
          >Company Name (Optional):</label
        >
        <input
          type="text"
          id="companyName"
          class="text-input"
          placeholder="Enter company name to begin with..."
          value=""
        />

        <label for="startPoint" class="input-label">Starting Point:</label>
        <select id="startPoint" class="text-input">
          <option value="none">None (Start from top)</option>
          <option value="company">Company Name</option>
        </select>
      </div>

      <div class="button-container">
        <button
          id="startButton"
          class="start-button"
          onclick="startAutomation()"
        >
          Start Automation
        </button>
      </div>

      <div class="status-container">
        <h3>Automation Status</h3>
        <div id="statusDisplay">
          <div class="status-item status-idle">
            <strong>Status:</strong> <span id="statusText">Idle</span>
          </div>
          <div class="status-item status-idle">
            <strong>Current Step:</strong>
            <span id="currentStep">No automation running</span>
          </div>
          <div class="status-item status-idle">
            <strong>Search Text:</strong> <span id="searchTextDisplay">-</span>
          </div>
          <div class="status-item status-idle">
            <strong>Company Name:</strong>
            <span id="companyNameDisplay">-</span>
          </div>
          <div class="status-item status-idle">
            <strong>Start Point:</strong> <span id="startPointDisplay">-</span>
          </div>
          <div class="status-item status-idle">
            <strong>Start Time:</strong> <span id="startTime">-</span>
          </div>
          <div class="status-item status-idle">
            <strong>End Time:</strong> <span id="endTime">-</span>
          </div>
          <div
            class="status-item status-idle"
            id="errorContainer"
            style="display: none"
          >
            <strong>Error:</strong> <span id="errorText">-</span>
          </div>
        </div>

        <button class="reset-button" onclick="resetStatus()">
          Reset Status
        </button>
      </div>
    </div>
    <footer class="stux-footer">
      Created by
      <a href="https://stuxtechnologies.com" target="_blank"
        >STUXTECHNOLOGIES LLC.</a
      >
    </footer>

    <script>
      let statusPollingInterval;

      // Start automation when button is clicked
      function startAutomation() {
        const button = document.getElementById("startButton");
        const statusText = document.getElementById("statusText");
        const searchTextInput = document.getElementById("searchText");
        const companyNameInput = document.getElementById("companyName");
        const startPointSelect = document.getElementById("startPoint");

        const searchText = searchTextInput.value.trim();
        const companyName = companyNameInput.value.trim();
        const startPoint = startPointSelect.value;

        // Validate input
        if (!searchText) {
          alert("Please enter some text to search for.");
          return;
        }

        // Validate company name if starting point is set to company
        if (startPoint === "company" && !companyName) {
          alert(
            "Please enter a company name when selecting 'Company Name' as starting point."
          );
          return;
        }

        // Disable button and show loading
        button.disabled = true;
        button.innerHTML = 'ðŸ”„ Starting... <div class="loading"></div>';
        statusText.innerHTML =
          'Starting automation... <div class="loading"></div>';

        // Make API call to start automation with search text and additional parameters
        fetch("/start_automation", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            search_text: searchText,
            company_name: companyName,
            start_point: startPoint,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              console.log(
                "Automation started successfully with search text:",
                searchText
              );
              // Start polling for status updates
              startStatusPolling();
            } else {
              alert("Failed to start automation: " + data.message);
              resetButton();
            }
          })
          .catch((error) => {
            console.error("Error starting automation:", error);
            alert("Error starting automation: " + error.message);
            resetButton();
          });
      }

      // Reset button to original state
      function resetButton() {
        const button = document.getElementById("startButton");
        button.disabled = false;
        button.innerHTML = "ðŸš€ Start Automation";
      }

      // Start polling for status updates
      function startStatusPolling() {
        // Poll every 2 seconds
        statusPollingInterval = setInterval(updateStatus, 2000);
      }

      // Update status display
      function updateStatus() {
        fetch("/status")
          .then((response) => response.json())
          .then((data) => {
            updateStatusDisplay(data);

            // Stop polling if automation is complete or failed
            if (!data.running && (data.completed || data.error)) {
              clearInterval(statusPollingInterval);
              resetButton();
            }
          })
          .catch((error) => {
            console.error("Error fetching status:", error);
          });
      }

      // Update the status display with new data
      function updateStatusDisplay(data) {
        const statusText = document.getElementById("statusText");
        const currentStep = document.getElementById("currentStep");
        const searchTextDisplay = document.getElementById("searchTextDisplay");
        const companyNameDisplay =
          document.getElementById("companyNameDisplay");
        const startPointDisplay = document.getElementById("startPointDisplay");
        const startTime = document.getElementById("startTime");
        const endTime = document.getElementById("endTime");
        const errorContainer = document.getElementById("errorContainer");
        const errorText = document.getElementById("errorText");

        // Update status text and styling
        if (data.running) {
          statusText.innerHTML = 'Running <div class="loading"></div>';
          statusText.parentElement.className = "status-item status-running";
        } else if (data.completed) {
          statusText.textContent = "Completed";
          statusText.parentElement.className = "status-item status-completed";
        } else if (data.error) {
          statusText.textContent = "Error";
          statusText.parentElement.className = "status-item status-error";
        } else {
          statusText.textContent = "Idle";
          statusText.parentElement.className = "status-item status-idle";
        }

        // Update other fields
        currentStep.textContent = data.current_step || "No automation running";
        searchTextDisplay.textContent = data.search_text || "-";
        companyNameDisplay.textContent = data.company_name || "-";
        startPointDisplay.textContent = data.start_point || "-";
        startTime.textContent = data.start_time || "-";
        endTime.textContent = data.end_time || "-";

        // Show/hide error container
        if (data.error) {
          errorText.textContent = data.error;
          errorContainer.style.display = "block";
        } else {
          errorContainer.style.display = "none";
        }
      }

      // Reset status
      function resetStatus() {
        fetch("/reset")
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // Reset display
              updateStatusDisplay({
                running: false,
                completed: false,
                error: null,
                start_time: null,
                end_time: null,
                current_step: null,
                search_text: null,
                company_name: null,
                start_point: null,
              });
              console.log("Status reset successfully");
            }
          })
          .catch((error) => {
            console.error("Error resetting status:", error);
          });
      }

      // Load initial status on page load
      document.addEventListener("DOMContentLoaded", function () {
        updateStatus();
      });
    </script>
  </body>
</html>
