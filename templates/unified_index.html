<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UPRS Unified Tool - PDF Filler & RPA Automation</title>
    <style>
      body {
        background: #1a2236;
        color: #fff;
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      .uprs-navbar {
        width: 100%;
        background: #232b43;
        padding: 0 0 0 0;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 200;
        box-shadow: 0 2px 8px rgba(26, 34, 54, 0.1);
        display: flex;
        align-items: center;
        height: 56px;
      }

      .uprs-navbar-logo {
        height: 40px;
        width: auto;
        margin-left: 24px;
        margin-right: 18px;
        display: block;
      }

      .uprs-navbar-link {
        color: #e5e7eb;
        font-size: 1.1rem;
        font-weight: 600;
        text-decoration: none;
        letter-spacing: 1px;
        transition: color 0.2s;
        margin-left: 8px;
      }

      .uprs-navbar-link:hover {
        color: #fff;
        text-decoration: underline;
      }

      .uprs-navbar-link-secondary {
        margin-left: 24px;
      }

      .main-container {
        margin-top: 70px;
        padding: 20px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      .tab-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 16px rgba(26, 34, 54, 0.1);
        overflow: hidden;
        margin-bottom: 20px;
      }

      .tab-header {
        background: #1a2236;
        display: flex;
        border-bottom: 3px solid #fff;
      }

      .tab-button {
        background: transparent;
        color: #e5e7eb;
        border: none;
        padding: 20px 30px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
        text-align: center;
        position: relative;
      }

      .tab-button.active {
        background: #fff;
        color: #1a2236;
      }

      .tab-button.active::after {
        content: "";
        position: absolute;
        bottom: -3px;
        left: 0;
        right: 0;
        height: 3px;
        background: #3b82f6;
      }

      .tab-content {
        display: none;
        padding: 30px;
        color: #1a2236;
      }

      .tab-content.active {
        display: block;
      }

      /* RPA Styles */
      .automation-header {
        display: flex;
        align-items: center;
        background: #1a2236;
        color: #fff;
        padding: 24px 32px;
        border-radius: 10px;
        margin-bottom: 32px;
        box-shadow: 0 2px 8px rgba(26, 34, 54, 0.08);
      }

      .automation-header span {
        font-size: 2.2rem;
        font-weight: bold;
        letter-spacing: 2px;
        color: #fff;
      }

      .input-container,
      .status-container {
        background: #f5f6fa;
        border-radius: 8px;
        padding: 24px 20px 20px 20px;
        margin-bottom: 28px;
        box-shadow: 0 1px 4px rgba(26, 34, 54, 0.04);
        color: #1a2236;
      }

      .input-label {
        color: #1a2236;
        font-weight: 500;
        margin-top: 12px;
        display: block;
      }

      .text-input,
      select,
      textarea {
        width: 100%;
        padding: 10px;
        margin: 8px 0 18px 0;
        border: 1px solid #1a2236;
        border-radius: 4px;
        background: #fff;
        color: #1a2236;
        font-size: 1rem;
        box-sizing: border-box;
      }

      .button-container {
        text-align: center;
        margin-bottom: 24px;
      }

      .start-button,
      .reset-button {
        background: #1a2236;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 12px 32px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        margin: 0 8px;
      }

      .start-button:hover,
      .reset-button:hover {
        background: #232b43;
      }

      .status-container h3 {
        color: #1a2236;
        margin-top: 0;
      }

      .status-item {
        margin-bottom: 10px;
        color: #1a2236;
      }

      .status-idle strong {
        color: #1a2236;
      }

      /* Checkbox styling */
      .checkbox-container {
        margin: 20px 0;
        padding: 16px;
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(26, 34, 54, 0.1);
      }

      .checkbox-label {
        color: #1a2236;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 12px;
        display: block;
      }

      .checkbox-controls {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }

      .checkbox-control-btn {
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        padding: 4px 12px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .checkbox-control-btn:hover {
        background: #e5e7eb;
        border-color: #9ca3af;
      }

      .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 0.95rem;
        color: #1a2236;
        position: relative;
        padding-left: 35px;
        user-select: none;
      }

      .checkbox-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
      }

      .checkmark {
        position: absolute;
        left: 0;
        height: 20px;
        width: 20px;
        background-color: #fff;
        border: 2px solid #1a2236;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .checkbox-item:hover input ~ .checkmark {
        background-color: #f8f9fa;
        border-color: #232b43;
      }

      .checkbox-item input:checked ~ .checkmark {
        background-color: #1a2236;
        border-color: #1a2236;
      }

      .checkmark:after {
        content: "";
        position: absolute;
        display: none;
        left: 6px;
        top: 2px;
        width: 6px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      .checkbox-item input:checked ~ .checkmark:after {
        display: block;
      }

      /* Loading animation */
      .loading {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #1a2236;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Status styling */
      .status-running {
        color: #1a2236;
      }
      .status-completed {
        color: #28a745;
      }
      .status-error {
        color: #dc3545;
      }

      /* PDF Filler Styles */
      .pdf-filler-header {
        background: #1a2236;
        color: #fff;
        padding: 24px 32px;
        border-radius: 10px;
        margin-bottom: 32px;
        text-align: center;
      }

      .pdf-filler-header h1 {
        font-size: 2.2rem;
        font-weight: bold;
        letter-spacing: 2px;
        margin: 0;
      }

      .section {
        margin-bottom: 2rem;
        padding: 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #f9fafb;
      }

      .section h2 {
        margin-top: 0;
        color: #374151;
        font-size: 1.1rem;
      }

      .field-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .field-group label {
        margin-top: 0;
      }

      .privacy-notice {
        background: #f3f4f6;
        padding: 0.75rem;
        border-radius: 6px;
        margin: 1rem 0;
        font-size: 0.9rem;
        color: #4b5563;
      }

      .highlight-section {
        background: #fef3c7;
        border: 2px solid #fbbf24;
        margin-top: 2rem;
      }

      .highlight-section h2 {
        color: #92400e;
      }

      .checkbox-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .checkbox-item-pdf {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        background: white;
        border: 1px solid #fbbf24;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .checkbox-item-pdf:hover {
        background: #fed7aa;
      }

      .checkbox-item-pdf input[type="checkbox"] {
        margin-right: 0.5rem;
        transform: scale(1.1);
      }

      .checkbox-item-pdf label {
        margin: 0;
        cursor: pointer;
        font-size: 0.9rem;
        color: #374151;
      }

      .custom-words {
        margin-top: 1rem;
      }

      .custom-words label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #374151;
      }

      .custom-words textarea {
        width: 100%;
        min-height: 80px;
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-family: inherit;
        resize: vertical;
      }

      .custom-words .hint {
        font-size: 0.8rem;
        color: #6b7280;
        margin-top: 0.5rem;
        text-align: left;
      }

      .highlight-button {
        background: #3b82f6;
        margin-top: 1rem;
      }

      .highlight-button:hover {
        background: #2563eb;
      }

      .hint {
        color: #6b7280;
        font-size: 0.9rem;
      }

      .flash {
        background: #fef3c7;
        color: #92400e;
        padding: 0.5rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .submit-button {
        background: #1a2236;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 12px 32px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        margin-top: 1rem;
      }

      .submit-button:hover {
        background: #232b43;
      }

      .stux-footer {
        text-align: center;
        color: #e5e7eb;
        background: transparent;
        font-size: 1rem;
        margin: 40px 0 16px 0;
      }

      .stux-footer a {
        color: #e5e7eb;
        text-decoration: underline;
        font-weight: 600;
      }

      .stux-footer a:hover {
        color: #fff;
      }

      @media (max-width: 800px) {
        .main-container {
          padding: 10px;
        }

        .tab-button {
          padding: 15px 20px;
          font-size: 1rem;
        }

        .field-group {
          grid-template-columns: 1fr;
        }

        .checkbox-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <nav class="uprs-navbar">
      <img
        src="/static/assets/uprs.png"
        alt="UPRS Logo"
        class="uprs-navbar-logo"
      />
      <a
        href="https://uprs-group-llc.monday.com/boards/9740813045"
        target="_blank"
        class="uprs-navbar-link"
        >Monday.com Board</a
      >
      <a
        href="https://www.uprsgroup.com/"
        target="_blank"
        class="uprs-navbar-link uprs-navbar-link-secondary"
        >UPRS Group Website</a
      >
    </nav>

    <div class="main-container">
      <div class="tab-container">
        <div class="tab-header">
          <button class="tab-button active" onclick="switchTab('pdf-filler')">
            PDF Filler
          </button>
          <button class="tab-button" onclick="switchTab('rpa')">
            RPA Automation
          </button>
        </div>

        <!-- PDF Filler Tab -->
        <div id="pdf-filler" class="tab-content active">
          <div class="pdf-filler-header">
            <h1>Enhanced Document Fill</h1>
          </div>

          {% with messages = get_flashed_messages() %} {% if messages %}
          <div class="flash">{{ messages[0] }}</div>
          {% endif %} {% endwith %}

          <p class="hint">
            Upload a .zip containing PDFs. Enter values to fill wherever the
            document has label anchors (e.g., "name:", "email:", etc.).
            <strong>Smart Detection:</strong> The system will automatically
            detect if fields are already filled and skip them to preserve
            existing data.
          </p>

          <form method="post" action="/fill_pdf" enctype="multipart/form-data">
            <div class="section">
              <h2>A. Claimant Information</h2>

              <label>Name if different than above</label>
              <input type="text" name="name" placeholder="DAVID RABINOW" />

              <label>Daytime Phone</label>
              <input type="text" name="phone" placeholder="(555) 123-4567" />

              <label>Current Address if different than above</label>
              <input
                type="text"
                name="address"
                placeholder="123 Main St, Springfield, IL"
              />

              <label>Email Address</label>
              <input
                type="email"
                name="email"
                placeholder="drabinow2@gmail.com"
              />

              <div class="field-group">
                <div>
                  <label>Date of Birth</label>
                  <input type="text" name="dob" placeholder="MM/DD/YYYY" />
                </div>
                <div>
                  <label>SSN/FEIN</label>
                  <input type="text" name="ein" placeholder="123-45-6789" />
                </div>
              </div>

              <div class="privacy-notice">
                <strong>PRIVACY PROTECTION:</strong> Please be assured that the
                Illinois State Treasurer does not use your social security
                number for any purpose other than to process your claim and
                fulfill the requirements of the Illinois Comptroller to issue a
                check for payment.
              </div>

              <div
                class="privacy-notice"
                style="background: #dbeafe; border-left: 4px solid #3b82f6"
              >
                <strong>SMART FIELD DETECTION:</strong> The system intelligently
                detects if fields are already filled:
                <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0">
                  <li><strong>Email:</strong> Skips if @ symbol is detected</li>
                  <li><strong>Phone:</strong> Skips if 7+ digits are found</li>
                  <li>
                    <strong>SSN/EIN:</strong> Skips if proper format is detected
                  </li>
                  <li>
                    <strong>Address:</strong> Skips if substantial text is
                    present
                  </li>
                </ul>
              </div>
            </div>

            <label>ZIP with PDFs</label>
            <input type="file" name="zipfile" accept=".zip" required />

            <button type="submit" class="submit-button">
              Process & Download
            </button>
          </form>

          <!-- Highlighting Section -->
          <div class="section highlight-section">
            <h2>‚úçÔ∏è Document Highlighting</h2>
            <p class="hint" style="text-align: left; margin-bottom: 1rem">
              Select words and phrases to highlight in your documents:
            </p>

            <form
              method="post"
              action="/highlight_pdf"
              enctype="multipart/form-data"
            >
              <div class="checkbox-grid">
                {% for word in common_highlights %}
                <div class="checkbox-item-pdf">
                  <input
                    type="checkbox"
                    id="word_{{ loop.index }}"
                    name="highlight_words"
                    value="{{ word }}"
                  />
                  <label for="word_{{ loop.index }}">{{ word }}</label>
                </div>
                {% endfor %}
              </div>

              <div class="custom-words">
                <label for="custom_words">Add Custom Words/Phrases:</label>
                <textarea
                  id="custom_words"
                  name="custom_words"
                  placeholder="Enter additional words or phrases to highlight, separated by commas or new lines.&#10;Example:&#10;DAVID RABINOW&#10;BLUE STAR ENERGY&#10;363 WEST ERIE STREET"
                ></textarea>
                <p class="hint">
                  Separate multiple words/phrases with commas, semicolons, or
                  new lines.
                </p>
              </div>

              <label for="highlight_zipfile"
                >üìÅ Upload ZIP File with PDFs:</label
              >
              <input
                type="file"
                id="highlight_zipfile"
                name="zipfile"
                accept=".zip"
                required
              />

              <button type="submit" class="highlight-button">
                ‚ú® Highlight Documents & Download
              </button>
            </form>
          </div>
        </div>

        <!-- RPA Automation Tab -->
        <div id="rpa" class="tab-content">
          <div class="automation-header">
            <span>Dynamic Navigation Tool</span>
          </div>

          <div class="input-container">
            <label for="dataFile" class="input-label"
              >Upload Data File (CSV, Excel, or Text):</label
            >
            <input
              type="file"
              id="dataFile"
              class="text-input"
              accept=".csv,.xlsx,.xls,.txt,.json"
              style="
                padding: 8px;
                border: 2px dashed #1a2236;
                background: #f8f9fa;
              "
            />
            <p style="font-size: 0.9rem; color: #6b7280; margin-top: 5px">
              Upload a file containing the data (EIN, Address, Email, Phone,
              etc.) that ChatGPT will use to process the automation.
            </p>

            <label for="highlightText" class="input-label"
              >Highlight Text (Multiple items separated by commas):</label
            >
            <textarea
              id="highlightText"
              class="text-input"
              placeholder="Enter what you want ChatGPT to highlight (e.g., signatures, dates, names, contract terms, amounts, addresses)..."
              rows="3"
              style="resize: vertical; min-height: 80px"
            ></textarea>

            <div class="checkbox-container">
              <label class="checkbox-label">Signature Options:</label>
              <div class="checkbox-controls">
                <button
                  type="button"
                  onclick="selectAllSignatures()"
                  class="checkbox-control-btn"
                >
                  Select All
                </button>
                <button
                  type="button"
                  onclick="clearAllSignatures()"
                  class="checkbox-control-btn"
                >
                  Clear All
                </button>
              </div>
              <div class="checkbox-group">
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureNotary"
                    name="signatureOptions"
                    value="notary"
                  />
                  <span class="checkmark"></span>
                  Signature of Notary
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureClaimant"
                    name="signatureOptions"
                    value="claimant"
                  />
                  <span class="checkmark"></span>
                  Signature of Claimant
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureNotaryPublic"
                    name="signatureOptions"
                    value="notaryPublic"
                  />
                  <span class="checkmark"></span>
                  Notary Public
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureRepresentative"
                    name="signatureOptions"
                    value="representative"
                  />
                  <span class="checkmark"></span>
                  Representative Signature
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureAuthorized"
                    name="signatureOptions"
                    value="authorized"
                  />
                  <span class="checkmark"></span>
                  Authorized Signer
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureApplicant"
                    name="signatureOptions"
                    value="applicant"
                  />
                  <span class="checkmark"></span>
                  Signature of Applicant
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureClaimantDetailed"
                    name="signatureOptions"
                    value="claimantDetailed"
                  />
                  <span class="checkmark"></span>
                  Signature of Claimant (Detailed)
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureClaimingAgent"
                    name="signatureOptions"
                    value="claimingAgent"
                  />
                  <span class="checkmark"></span>
                  Claiming Agent's Signature
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureNA"
                    name="signatureOptions"
                    value="na"
                  />
                  <span class="checkmark"></span>
                  N/A
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureElectronic"
                    name="signatureOptions"
                    value="electronic"
                  />
                  <span class="checkmark"></span>
                  Electronic Signature Not Accepted
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureGeneric"
                    name="signatureOptions"
                    value="generic"
                  />
                  <span class="checkmark"></span>
                  Signature (Generic)
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureOwner"
                    name="signatureOptions"
                    value="owner"
                  />
                  <span class="checkmark"></span>
                  Claimant/Owner Signature
                </label>
                <label class="checkbox-item">
                  <input
                    type="checkbox"
                    id="signatureFull"
                    name="signatureOptions"
                    value="full"
                  />
                  <span class="checkmark"></span>
                  Full Signature
                </label>
              </div>
            </div>

            <label for="nameInput" class="input-label"
              >Enter name to fill in PDF forms:</label
            >
            <input
              type="text"
              id="nameInput"
              class="text-input"
              placeholder="Enter the name to fill in PDF name fields (e.g., John Doe)..."
            />
          </div>

          <div class="button-container">
            <button
              id="startButton"
              class="start-button"
              onclick="startAutomation()"
            >
              Start Automation
            </button>
          </div>

          <div class="status-container">
            <h3>Automation Status</h3>
            <div id="statusDisplay">
              <div class="status-item status-idle">
                <strong>Status:</strong> <span id="statusText">Idle</span>
              </div>
              <div class="status-item status-idle">
                <strong>Current Step:</strong>
                <span id="currentStep">No automation running</span>
              </div>

              <div class="status-item status-idle">
                <strong>Data File:</strong> <span id="dataFileDisplay">-</span>
              </div>
              <div class="status-item status-idle">
                <strong>Highlight Text:</strong>
                <span id="highlightTextDisplay">-</span>
              </div>
              <div class="status-item status-idle">
                <strong>Signature Options:</strong>
                <span id="signatureOptionsDisplay">-</span>
              </div>
              <div class="status-item status-idle">
                <strong>Start Time:</strong> <span id="startTime">-</span>
              </div>
              <div class="status-item status-idle">
                <strong>End Time:</strong> <span id="endTime">-</span>
              </div>
              <div
                class="status-item status-idle"
                id="errorContainer"
                style="display: none"
              >
                <strong>Error:</strong> <span id="errorText">-</span>
              </div>
            </div>

            <button class="reset-button" onclick="resetStatus()">
              Reset Status
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="stux-footer">
      Created by
      <a href="https://stuxtechnologies.com" target="_blank"
        >STUX TECHNOLOGIES LLC.</a
      >
    </footer>

    <script>
      let statusPollingInterval;

      // Tab switching functionality
      function switchTab(tabName) {
        // Hide all tab contents
        const tabContents = document.querySelectorAll(".tab-content");
        tabContents.forEach((content) => {
          content.classList.remove("active");
        });

        // Remove active class from all tab buttons
        const tabButtons = document.querySelectorAll(".tab-button");
        tabButtons.forEach((button) => {
          button.classList.remove("active");
        });

        // Show selected tab content
        document.getElementById(tabName).classList.add("active");

        // Add active class to clicked button
        event.target.classList.add("active");
      }

      // RPA Automation Functions
      function startAutomation() {
        const button = document.getElementById("startButton");
        const statusText = document.getElementById("statusText");
        const dataFileInput = document.getElementById("dataFile");
        const highlightTextInput = document.getElementById("highlightText");
        const nameInput = document.getElementById("nameInput");

        const dataFile = dataFileInput.files[0];
        const highlightText = highlightTextInput.value.trim();
        const nameText = nameInput.value.trim();

        // Get checkbox values
        const signatureNotary =
          document.getElementById("signatureNotary").checked;
        const signatureClaimant =
          document.getElementById("signatureClaimant").checked;
        const signatureNotaryPublic = document.getElementById(
          "signatureNotaryPublic"
        ).checked;
        const signatureRepresentative = document.getElementById(
          "signatureRepresentative"
        ).checked;
        const signatureAuthorized = document.getElementById(
          "signatureAuthorized"
        ).checked;
        const signatureApplicant =
          document.getElementById("signatureApplicant").checked;
        const signatureClaimantDetailed = document.getElementById(
          "signatureClaimantDetailed"
        ).checked;
        const signatureClaimingAgent = document.getElementById(
          "signatureClaimingAgent"
        ).checked;
        const signatureNA = document.getElementById(
          "signatureNA"
        ).checked;
        const signatureElectronic = document.getElementById(
          "signatureElectronic"
        ).checked;
        const signatureGeneric = document.getElementById(
          "signatureGeneric"
        ).checked;
        const signatureOwner = document.getElementById(
          "signatureOwner"
        ).checked;
        const signatureFull = document.getElementById(
          "signatureFull"
        ).checked;

        // Validate file upload
        if (!dataFile) {
          alert("Please upload a data file.");
          return;
        }

        // Disable button and show loading
        button.disabled = true;
        button.innerHTML =
          'üîÑ Starting automation... <div class="loading"></div>';
        statusText.innerHTML =
          'Starting automation... <div class="loading"></div>';

        // Create FormData to send file and other data
        const formData = new FormData();
        formData.append("data_file", dataFile);
        formData.append("highlight_text", highlightText);
        formData.append("name_text", nameText);
        formData.append(
          "signature_options",
          JSON.stringify({
            notary: signatureNotary,
            claimant: signatureClaimant,
            notaryPublic: signatureNotaryPublic,
            representative: signatureRepresentative,
            authorized: signatureAuthorized,
            applicant: signatureApplicant,
            claimantDetailed: signatureClaimantDetailed,
            claimingAgent: signatureClaimingAgent,
            na: signatureNA,
            electronic: signatureElectronic,
            generic: signatureGeneric,
            owner: signatureOwner,
            full: signatureFull,
          })
        );

        // Make API call to start automation
        fetch("/start_automation", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              console.log("Automation started successfully");
              startStatusPolling();
            } else {
              alert("Failed to start automation: " + data.message);
              resetButton();
            }
          })
          .catch((error) => {
            console.error("Error starting automation:", error);
            alert("Error starting automation: " + error.message);
            resetButton();
          });
      }

      function resetButton() {
        const button = document.getElementById("startButton");
        button.disabled = false;
        button.innerHTML = "üöÄ Start Automation";
      }

      function startStatusPolling() {
        statusPollingInterval = setInterval(updateStatus, 2000);
      }

      function updateStatus() {
        fetch("/automation_status")
          .then((response) => response.json())
          .then((data) => {
            updateStatusDisplay(data);

            if (!data.running && (data.completed || data.error)) {
              clearInterval(statusPollingInterval);
              resetButton();
            }
          })
          .catch((error) => {
            console.error("Error fetching status:", error);
          });
      }

      function updateStatusDisplay(data) {
        const statusText = document.getElementById("statusText");
        const currentStep = document.getElementById("currentStep");
        const dataFileDisplay = document.getElementById("dataFileDisplay");
        const highlightTextDisplay = document.getElementById(
          "highlightTextDisplay"
        );
        const signatureOptionsDisplay = document.getElementById(
          "signatureOptionsDisplay"
        );
        const startTime = document.getElementById("startTime");
        const endTime = document.getElementById("endTime");
        const errorContainer = document.getElementById("errorContainer");
        const errorText = document.getElementById("errorText");

        if (data.running) {
          statusText.innerHTML = 'Running <div class="loading"></div>';
          statusText.parentElement.className = "status-item status-running";
        } else if (data.completed) {
          statusText.textContent = "Completed";
          statusText.parentElement.className = "status-item status-completed";
        } else if (data.error) {
          statusText.textContent = "Error";
          statusText.parentElement.className = "status-item status-error";
        } else {
          statusText.textContent = "Idle";
          statusText.parentElement.className = "status-item status-idle";
        }

        currentStep.textContent = data.current_step || "No automation running";
        dataFileDisplay.textContent = data.data_file || "-";
        highlightTextDisplay.textContent = data.highlight_text || "-";

        let signatureOptionsText = "-";
        if (data.signature_options) {
          const options = data.signature_options;
          const selectedOptions = [];
          if (options.notary) selectedOptions.push("Notary");
          if (options.claimant) selectedOptions.push("Claimant");
          if (options.notaryPublic) selectedOptions.push("Notary Public");
          if (options.representative) selectedOptions.push("Representative");
          if (options.authorized) selectedOptions.push("Authorized Signer");
          if (options.applicant) selectedOptions.push("Applicant");
          if (options.claimantDetailed) selectedOptions.push("Claimant Detailed");
          if (options.claimingAgent) selectedOptions.push("Claiming Agent");
          if (options.na) selectedOptions.push("N/A");
          if (options.electronic) selectedOptions.push("Electronic");
          if (options.generic) selectedOptions.push("Generic");
          if (options.owner) selectedOptions.push("Owner");
          if (options.full) selectedOptions.push("Full");
          signatureOptionsText =
            selectedOptions.length > 0
              ? selectedOptions.join(", ")
              : "None selected";
        }
        signatureOptionsDisplay.textContent = signatureOptionsText;

        startTime.textContent = data.start_time || "-";
        endTime.textContent = data.end_time || "-";

        if (data.error) {
          errorText.textContent = data.error;
          errorContainer.style.display = "block";
        } else {
          errorContainer.style.display = "none";
        }
      }

      function resetStatus() {
        fetch("/reset_automation")
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              updateStatusDisplay({
                running: false,
                completed: false,
                error: null,
                start_time: null,
                end_time: null,
                current_step: null,
                data_file: null,
                highlight_text: null,
                signature_options: null,
              });
              console.log("Status reset successfully");
            }
          })
          .catch((error) => {
            console.error("Error resetting status:", error);
          });
      }

      function selectAllSignatures() {
        const checkboxes = [
          "signatureNotary",
          "signatureClaimant",
          "signatureNotaryPublic",
          "signatureRepresentative",
          "signatureAuthorized",
          "signatureApplicant",
          "signatureClaimantDetailed",
          "signatureClaimingAgent",
          "signatureNA",
          "signatureElectronic",
          "signatureGeneric",
          "signatureOwner",
          "signatureFull",
        ];
        checkboxes.forEach((id) => {
          document.getElementById(id).checked = true;
        });
      }

      function clearAllSignatures() {
        const checkboxes = [
          "signatureNotary",
          "signatureClaimant",
          "signatureNotaryPublic",
          "signatureRepresentative",
          "signatureAuthorized",
          "signatureApplicant",
          "signatureClaimantDetailed",
          "signatureClaimingAgent",
          "signatureNA",
          "signatureElectronic",
          "signatureGeneric",
          "signatureOwner",
          "signatureFull",
        ];
        checkboxes.forEach((id) => {
          document.getElementById(id).checked = false;
        });
      }

      // Load initial status on page load
      document.addEventListener("DOMContentLoaded", function () {
        updateStatus();
      });
    </script>
  </body>
</html>
